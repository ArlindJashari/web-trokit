---
import { siteData } from "../../data/siteContent";
---

<section
  id="projects"
  class="bg-black text-white py-12 md:py-24 border-b border-white/10"
>
  <div class="max-w-[1440px] mx-auto px-6">
    <div class="flex justify-center mb-12 md:mb-24">
      <h2
        class="text-4xl md:text-6xl lg:text-[80px] font-display uppercase tracking-[-0.04em] font-black text-center"
      >
        Transformation <br /> Gallery
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-[400px]">
      {
        siteData.projects.map((project, index) => (
          <div
            class={`group relative cursor-pointer overflow-hidden border border-white/10 ${
              project.span || ""
            }`}
            data-gallery-item
            data-image={project.image}
            data-title={project.title}
          >
            <img
              src={project.image}
              alt={project.title}
              class="h-full w-full object-cover transition-transform duration-1000 group-hover:scale-105"
            />

            {/* Index Overlay */}
            <div class="absolute top-6 left-6 bg-black/80 px-3 py-1.5 text-[10px] tracking-[0.3em] text-white/60 border border-white/10 backdrop-blur-md z-10 font-black">
              0{index + 1}
            </div>

            {/* Hover Overlay - Subtle */}
            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-center justify-center">
              <div class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center backdrop-blur-sm">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  fill="currentColor"
                  viewBox="0 0 256 256"
                >
                  <path
                    d="M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z"
                    opacity="0.2"
                  />
                  <path d="M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Zm-16,0a80,80,0,1,0-80,80A80,80,0,0,0,208,128Zm-72-40v32H104a8,8,0,0,0,0,16h32v32a8,8,0,0,0,16,0V136h32a8,8,0,0,0,0-16H152V88a8,8,0,0,0-16,0Z" />
                </svg>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>

  {/* Full View Modal */}
  <div
    id="gallery-modal"
    class="fixed inset-0 z-[200] bg-black/95 backdrop-blur-2xl opacity-0 pointer-events-none transition-all duration-500 flex items-center justify-center p-6 md:p-12"
  >
    <button
      id="close-modal"
      class="absolute top-8 right-8 text-white/50 hover:text-white transition-colors z-[210] p-4"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="32"
        height="32"
        fill="currentColor"
        viewBox="0 0 256 256"
        ><path
          d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"
        ></path>
      </svg>
    </button>

    <div
      class="relative w-full h-full flex flex-col items-center justify-center gap-6"
    >
      <img
        id="modal-image"
        src=""
        alt=""
        class="max-w-full max-h-[85vh] object-contain shadow-2xl rounded-sm"
      />
      <h3
        id="modal-title"
        class="text-xl font-display uppercase tracking-[0.2em] text-white/80"
      >
      </h3>
    </div>
  </div>
</section>

<script>
  const modal = document.getElementById("gallery-modal");
  const modalImg = document.getElementById("modal-image") as HTMLImageElement;
  const modalTitle = document.getElementById("modal-title");
  const closeBtn = document.getElementById("close-modal");
  const items = document.querySelectorAll("[data-gallery-item]");

  const openModal = (imgSrc: string, title: string) => {
    if (!modal || !modalImg || !modalTitle) return;
    modalImg.src = imgSrc;
    modalTitle.innerText = title;
    modal.classList.remove("opacity-0", "pointer-events-none");
    document.body.style.overflow = "hidden";

    // Stop Lenis if it exists
    if ((window as any).lenis) (window as any).lenis.stop();
  };

  const closeModal = () => {
    if (!modal) return;
    modal.classList.add("opacity-0", "pointer-events-none");
    document.body.style.overflow = "";

    // Start Lenis if it exists
    if ((window as any).lenis) (window as any).lenis.start();
  };

  items.forEach((item) => {
    item.addEventListener("click", () => {
      const img = item.getAttribute("data-image");
      const title = item.getAttribute("data-title");
      if (img && title) openModal(img, title);
    });
  });

  closeBtn?.addEventListener("click", closeModal);
  modal?.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
  });
</script>
